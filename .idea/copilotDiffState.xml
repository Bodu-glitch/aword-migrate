<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/supabase/migrations/20250926132104_children_word.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/supabase/migrations/20250926132104_children_word.sql" />
              <option name="originalContent" value="-- =========================&#10;-- N-N: Người ↔ Từ (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_vocab_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    vocab_id        uuid not null references public.vocab(id) on delete cascade,&#10;&#10;--     status          text not null default 'learning',  -- learning|review|mastered (tùy bạn)&#10;    proficiency     numeric(4,2) default 0.00,         -- thời gian học càng ít, trả lời đúng càng nhiều thì càng cao (0.00..1.00)&#10;    last_seen_at    timestamptz,&#10;--     next_review_at  timestamptz,&#10;    first_learned_at timestamptz default now(),&#10;&#10;    primary key (profile_id, vocab_id)&#10;    );&#10;&#10;create index if not exists idx_uvp_profile on public.profile_vocab_progress(profile_id);&#10;create index if not exists idx_uvp_vocab on public.profile_vocab_progress(vocab_id);&#10;-- create index if not exists idx_uvp_next_review on public.profile_vocab_progress(next_review_at);&#10;&#10;-- =========================&#10;-- Lịch sử: Người ↔ Từ (mỗi lượt ôn/làm bài)&#10;-- =========================&#10;-- create table if not exists public.profile_vocab_reviews (&#10;--                                                          id              uuid primary key default gen_random_uuid(),&#10;--     profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;--     vocab_id        uuid not null references public.vocab(id) on delete cascade,&#10;--&#10;--     reviewed_at     timestamptz not null default now(),&#10;--     result          smallint,           -- 0..3 (Again/Hard/Good/Easy) hoặc 0/1 đúng-sai&#10;--     latency_ms      integer,            -- thời gian trả lời&#10;--     note            text&#10;--     );&#10;--&#10;-- create index if not exists idx_uvr_profile_vocab_time&#10;--     on public.profile_vocab_reviews(profile_id, vocab_id, reviewed_at desc);&#10;&#10;-- =========================&#10;-- N-N: Người ↔ Gốc (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_root_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    root_id         uuid not null references public.roots(id) on delete cascade,&#10;&#10;    started_at      timestamptz not null default now(),&#10;--     last_seen_at    timestamptz,&#10;--     mastered_ratio  numeric(5,2) default 0.00,    -- % từ của gốc đã mastered&#10;    is_learning     boolean not null default true,            -- còn học gốc này không&#10;&#10;    primary key (profile_id, root_id)&#10;    );&#10;&#10;create index if not exists idx_urp_profile on public.profile_root_progress(profile_id);&#10;create index if not exists idx_urp_root on public.profile_root_progress(root_id);&#10;&#10;&#10;-- =========================&#10;-- Child Root of Vocab (Gốc từ con của vocab)&#10;-- =========================&#10;create table if not exists public.vocab_sub_roots (&#10;    id uuid primary key default gen_random_uuid(),&#10;    vocab_id uuid not null unique references public.vocab(id) on delete cascade,&#10;    token text not null, -- gốc con&#10;    defination text, -- nghĩa gốc con&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_vchildroot_vocab on public.vocab_sub_roots(vocab_id);&#10;&#10;-- =========================&#10;-- Sub Vocab (Từ con của gốc từ con)&#10;-- =========================&#10;create table if not exists public.sub_vocab (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_root_id uuid not null references public.vocab_sub_roots(id) on delete cascade,&#10;    word text not null unique,&#10;    prefix text,&#10;    infix text,&#10;    postfix text,&#10;    prefix_meaning text,&#10;    infix_meaning text,&#10;    postfix_meaning text,&#10;    phonetic text,&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_subvocab_subroot on public.sub_vocab(sub_root_id);&#10;&#10;-- =========================&#10;-- N-N: Người ↔ Gốc từ con (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_sub_vocab_progress (&#10;    profile_id uuid not null references public.profiles(id) on delete cascade,&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    started_at timestamptz not null default now(),&#10;    proficiency     numeric(4,2) default 0.00,         -- thời gian học càng ít, trả lời đúng càng nhiều thì càng cao (0.00..1.00)&#10;    last_seen_at    timestamptz,&#10;--     next_review_at  timestamptz,&#10;    first_learned_at timestamptz default now(),&#10;    primary key (profile_id, sub_vocab_id)&#10;    );&#10;&#10;&#10;-- =========================&#10;-- Sub Vocab Senses (nghĩa theo loại từ của sub_vocab)&#10;-- =========================&#10;create table if not exists public.sub_vocab_sense (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    word text not null,&#10;    pos pos_type not null,&#10;    definition text not null,&#10;    sense_order smallint default 1,&#10;    created_at timestamptz not null default now(),&#10;    unique (sub_vocab_id, word, pos)&#10;);&#10;&#10;create index if not exists idx_subvocabsense_subvocab on public.sub_vocab_sense(sub_vocab_id);&#10;&#10;-- =========================&#10;-- Sub Vocab Examples (ví dụ của sub_vocab)&#10;-- =========================&#10;create table if not exists public.sub_vocab_example (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    example_en text not null,&#10;    example_vi text,&#10;    example_order smallint default 1,&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_subvocabexample_subvocab on public.sub_vocab_example(sub_vocab_id);&#10;&#10;&#10;create table if not exists public.profile_sub_root_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    sub_root_id         uuid not null references public.vocab_sub_roots(id) on delete cascade,&#10;&#10;    started_at      timestamptz not null default now(),&#10;    --     last_seen_at    timestamptz,&#10;--     mastered_ratio  numeric(5,2) default 0.00,    -- % từ của gốc đã mastered&#10;    is_learning     boolean not null default true,            -- còn học gốc này không&#10;&#10;    primary key (profile_id, sub_root_id)&#10;    );&#10;&#10;create index if not exists idx_urp_profile_sub on public.profile_sub_root_progress(profile_id);&#10;create index if not exists idx_urp_root_sub on public.profile_sub_root_progress(sub_root_id);" />
              <option name="updatedContent" value="-- =========================&#10;-- N-N: Người ↔ Từ (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_vocab_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    vocab_id        uuid not null references public.vocab(id) on delete cascade,&#10;&#10;--     status          text not null default 'learning',  -- learning|review|mastered (tùy bạn)&#10;    proficiency     numeric(4,2) default 0.00,         -- thời gian học càng ít, trả lời đúng càng nhiều thì càng cao (0.00..1.00)&#10;    last_seen_at    timestamptz,&#10;--     next_review_at  timestamptz,&#10;    first_learned_at timestamptz default now(),&#10;&#10;    primary key (profile_id, vocab_id)&#10;    );&#10;&#10;create index if not exists idx_uvp_profile on public.profile_vocab_progress(profile_id);&#10;create index if not exists idx_uvp_vocab on public.profile_vocab_progress(vocab_id);&#10;-- create index if not exists idx_uvp_next_review on public.profile_vocab_progress(next_review_at);&#10;&#10;-- =========================&#10;-- Lịch sử: Người ↔ Từ (mỗi lượt ôn/làm bài)&#10;-- =========================&#10;-- create table if not exists public.profile_vocab_reviews (&#10;--                                                          id              uuid primary key default gen_random_uuid(),&#10;--     profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;--     vocab_id        uuid not null references public.vocab(id) on delete cascade,&#10;--&#10;--     reviewed_at     timestamptz not null default now(),&#10;--     result          smallint,           -- 0..3 (Again/Hard/Good/Easy) hoặc 0/1 đúng-sai&#10;--     latency_ms      integer,            -- thời gian trả lời&#10;--     note            text&#10;--     );&#10;--&#10;-- create index if not exists idx_uvr_profile_vocab_time&#10;--     on public.profile_vocab_reviews(profile_id, vocab_id, reviewed_at desc);&#10;&#10;-- =========================&#10;-- N-N: Người ↔ Gốc (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_root_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    root_id         uuid not null references public.roots(id) on delete cascade,&#10;&#10;    started_at      timestamptz not null default now(),&#10;--     last_seen_at    timestamptz,&#10;--     mastered_ratio  numeric(5,2) default 0.00,    -- % từ của gốc đã mastered&#10;    is_learning     boolean not null default true,            -- còn học gốc này không&#10;&#10;    primary key (profile_id, root_id)&#10;    );&#10;&#10;create index if not exists idx_urp_profile on public.profile_root_progress(profile_id);&#10;create index if not exists idx_urp_root on public.profile_root_progress(root_id);&#10;&#10;&#10;-- =========================&#10;-- Child Root of Vocab (Gốc từ con của vocab)&#10;-- =========================&#10;create table if not exists public.vocab_sub_roots (&#10;    id uuid primary key default gen_random_uuid(),&#10;    vocab_id uuid not null unique references public.vocab(id) on delete cascade,&#10;    token text not null, -- gốc con&#10;    defination text, -- nghĩa gốc con&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_vchildroot_vocab on public.vocab_sub_roots(vocab_id);&#10;&#10;-- =========================&#10;-- Sub Vocab (Từ con của gốc từ con)&#10;-- =========================&#10;create table if not exists public.sub_vocab (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_root_id uuid not null references public.vocab_sub_roots(id) on delete cascade,&#10;    word text not null unique,&#10;    prefix text,&#10;    infix text,&#10;    postfix text,&#10;    prefix_meaning text,&#10;    infix_meaning text,&#10;    postfix_meaning text,&#10;    phonetic text,&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_subvocab_subroot on public.sub_vocab(sub_root_id);&#10;&#10;-- =========================&#10;-- N-N: Người ↔ Gốc từ con (trạng thái hiện tại)&#10;-- =========================&#10;create table if not exists public.profile_sub_vocab_progress (&#10;    profile_id uuid not null references public.profiles(id) on delete cascade,&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    started_at timestamptz not null default now(),&#10;    proficiency     numeric(4,2) default 0.00,         -- thời gian học càng ít, trả lời đúng càng nhiều thì càng cao (0.00..1.00)&#10;    last_seen_at    timestamptz,&#10;--     next_review_at  timestamptz,&#10;    first_learned_at timestamptz default now(),&#10;    primary key (profile_id, sub_vocab_id)&#10;    );&#10;&#10;&#10;-- =========================&#10;-- Sub Vocab Senses (nghĩa theo loại từ của sub_vocab)&#10;-- =========================&#10;create table if not exists public.sub_vocab_sense (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    word text not null,&#10;    pos pos_type not null,&#10;    definition text not null,&#10;    sense_order smallint default 1,&#10;    created_at timestamptz not null default now(),&#10;    unique (sub_vocab_id, word, pos)&#10;);&#10;&#10;create index if not exists idx_subvocabsense_subvocab on public.sub_vocab_sense(sub_vocab_id);&#10;&#10;-- =========================&#10;-- Sub Vocab Examples (ví dụ của sub_vocab)&#10;-- =========================&#10;create table if not exists public.sub_vocab_example (&#10;    id uuid primary key default gen_random_uuid(),&#10;    sub_vocab_id uuid not null references public.sub_vocab(id) on delete cascade,&#10;    example_en text not null,&#10;    example_vi text,&#10;    example_order smallint default 1,&#10;    created_at timestamptz not null default now()&#10;);&#10;&#10;create index if not exists idx_subvocabexample_subvocab on public.sub_vocab_example(sub_vocab_id);&#10;&#10;&#10;create table if not exists public.profile_sub_root_progress (&#10;    profile_id         uuid not null references public.profiles(id) on delete cascade,&#10;    sub_root_id         uuid not null references public.vocab_sub_roots(id) on delete cascade,&#10;&#10;    started_at      timestamptz not null default now(),&#10;    --     last_seen_at    timestamptz,&#10;--     mastered_ratio  numeric(5,2) default 0.00,    -- % từ của gốc đã mastered&#10;    is_learning     boolean not null default true,            -- còn học gốc này không&#10;&#10;    primary key (profile_id, sub_root_id)&#10;    );&#10;&#10;create index if not exists idx_urp_profile_sub on public.profile_sub_root_progress(profile_id);&#10;create index if not exists idx_urp_root_sub on public.profile_sub_root_progress(sub_root_id);" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>